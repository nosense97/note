<html>

<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <div id="chart_div"></div>


    <script>
        function loadHQCharts() {
            // CHART #1 
            google.load('visualization', '1', {
                'packages': ['corechart'],
                callback: drawChartDishMix
            });
            // CHART #2 
            google.load('visualization', '1', {
                'packages': ['corechart'],
                callback: drawChartMenuMix
            });
            // CHART #3 
            google.load('visualization', '1', {
                'packages': ['corechart'],
                callback: drawChartStoreMix
            });
        };

        function drawChartStoreMix() {

            var url = window.location.origin + '/tce-php/getdata.php?var=HQLOADMMS';

            jQuery.getJSON(url, function(json) {

                    // convert JSON to chart required format
                    var stores = _.chain(json).pluck("store_name").sort().uniq(true).value();

                    var tempHTML = "";
                    jQuery('#store_list').empty();

                    stores.forEach(function(entry) {
                        tempHTML = tempHTML + '<option value="' + entry + '">' + entry + '</option>';
                    });

                    /*** Load data into drop down lists here ***/
                    var store_selector = document.getElementById('store_list');
                    store_selector.insertAdjacentHTML('beforeend', tempHTML);
                    /*** Load default selections for top of drop down lists here ***/
                    store_selector.insertAdjacentHTML('afterbegin', '<option selected="selected" value="ALL">All Stores...</option>');

                    var header = _.chain(json).pluck("dish_menu").sort().uniq(true).value();
                    header.unshift("Menus");

                    var rows = _.chain(json)
                        .groupBy(function(item) {
                            return item.store_name;
                        })
                        .map(function(group, key) {
                            var result = [key];
                            _.each(group, function(item) {
                                result[_.indexOf(header, item.dish_menu)] = parseInt(item.dish_count);
                            });
                            return result;
                        })
                        .value();

                    var jsonData = [header].concat(rows);
                    var data = google.visualization.arrayToDataTable(jsonData);

                    // Set chart options
                    var options = {
                        title: 'Menu Mix By Store',
                        titleTextStyle: {
                            color: '#747474',
                            fontSize: '15',
                            bold: false
                        },
                        isStacked: true,
                        chartArea: {
                            left: '55',
                            top: '50',
                            width: '88%',
                            height: '65%'
                        },
                        is3D: true,
                        legend: {
                            position: 'top'
                        },
                        legendTextStyle: {
                            color: '#747474',
                            fontSize: '11',
                            bold: false
                        },
                        bar: {
                            groupWidth: '75%'
                        },
                        vAxis: {
                            title: '',
                            textStyle: {
                                color: '#747474',
                                fontSize: '11',
                                paddingRight: '0',
                                marginRight: '0'
                            }
                        },
                        hAxis: {
                            title: '',
                            textStyle: {
                                color: '#747474',
                                fontSize: '11',
                                paddingRight: '0',
                                marginRight: '0'
                            }
                        }
                        //          vAxis: {title: '# Dishes'},
                        //          hAxis: {title: 'Stores'}                
                        //          legend: {position: 'none'},
                    };

                    // Instantiate and draw our chart, passing in some options.
                    var chart = new google.visualization.ColumnChart(document.getElementById('fran_mix'));
                    chart.draw(data, options);

                })
                .done(function() {})
                .fail(function() {});
        };
    </script>

    <!-- <script src="./const.js"></script> -->
    <script type="module" src="./main.js"></script>
    <script type="module" src="./const.js"></script>
</body>

</html>